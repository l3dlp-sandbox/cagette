<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="::LANG::" style="font-size:16px">

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" xml:lang="::LANG::" lang="::LANG::"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>
        ::if pageTitle!=null::
            ::pageTitle::
        ::else::
            ::theme.name::
        ::end::
    </title>

    $$favicons()

    $$googleTagManager(::getVariable("googleTagManagerId")::)

    <!-- Cagette CSS -->
    ::if(DEBUG)::
        <link rel="stylesheet" type="text/css" href="/theme/::theme.id::/css/::getVariable('css')::/style.css" />
    ::else::
        <link rel="stylesheet" type="text/css" href="/theme/::theme.id::/css/::getVariable('css')::/style.min.css" />
    ::end::

    <!-- BOOTSTRAP -->
    ::if noBootstrap::
    ::else::
        <link rel="stylesheet" href="/theme/::theme.id::/css/::getVariable('css')::/bootstrap.min.css" />
    ::end::

    <!-- Cagette very own icon font -->
    <link rel="stylesheet" href="/font/icons.css?v=::getVariable('css')::" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
        integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />

	::if(DEBUG)::
    <script type="text/javascript" src="/js/::getVariable('js')::/libs.dev.js"></script>
    ::else::
    <script type="text/javascript" src="/js/::getVariable('js')::/libs.prod.js"></script>
    ::end::
</head>

::if container==null:: ::set container="container":: ::end::

<body class="::container::">

    ::if DEBUG::
    <div style="position: fixed;background: #666;padding: 8px;left: 0;bottom:0;color:#FF0; z-index:9999;">DEBUG</div>
    ::end::

    ::if ( HOST.indexOf(".dev.",null)!=-1 )::
    <div style="position: fixed;background: #600;padding: 8px;left:0;bottom:0;color: #FA0;width: 100%;z-index: 99;text-align: center;">
        <i class="icon icon-alert"></i> 
        <b>Ce site est une instance de test.</b> Ne l'utilisez pas pour prendre de vraies commandes.
    </div>
    ::end::

    <!-- Modal window -->
    <div id="myModal" />

    <div style="display: flex;">
        <style>
            .nav-placeholder {
                min-width: 240px;
            }
            @media (max-width: 900px){
                .nav-placeholder {
                    min-width: 65px;
                }
            }
            @media (max-width: 600px){
                .nav-md {
                    display: none;
                }
                #cavea-footer {
                    margin-bottom: 40px;
                }
            }
        </style>

        <div class="nav-placeholder">
            <div class="nav-placeholder nav-md" style="background-color: white; position: absolute; top: 0; bottom: 0; left: 0; border-right: 1px solid rgba(0, 0, 0, 0.12);"/>
            <div id='navigation-neo-container' />
        </div>

		<div style="flex-grow: 1;">
			<div style="min-height: 64px;">
				<div class="header-placeholder" style="position: absolute; top: 0; right: 0; left: 0;"/>
				<div id='header-neo-container'/>
			</div>
            ::raw __content__::
        </div>
    </div>

	<script language="javascript">

		window.addEventListener("DOMContentLoaded", function() {
			::set group = getCurrentGroup()::
			::if(user!=null)::
				neo.createNeoModule("header-neo-container", "pageHeader", {
					groupName: ::if(group!=null):: "::group.name::" ::else:: null ::end::,
					userName: "::user.getName()::",
					isSuperAdmin: ::isAdmin::
				});
			::else::
				neo.createNeoModule("header-neo-container", "pageHeader", {
					groupName: ::if(group!=null):: "::group.name::" ::else:: null ::end::,
				});
			::end::

			neo.createNeoModule("navigation-neo-container", "navigation", {
				groupName: ::if(group!=null):: "::group.name::" ::else:: null ::end::,
				vendors: [
					::foreach cpro cagettePros::
					{
						id: ::cpro._vendor.id::,
						name: "::cpro._vendor.name::"
					},
					::end::
					]
			});

		});
	</script>

    $$googleTagManagerNoScript(::getVariable("googleTagManagerId")::)

    <script type="text/javascript">

        window._Cagette = {
			theme: {
				id: "::theme.id::",
				name: "::theme.name::",
				supportEmail: "::theme.supportEmail::"
			}
		}
        
        document.addEventListener("DOMContentLoaded", function (event) {
            //init vars in js App
            _Cagette.lang = "::session.lang::";
            :: if (user != null)::
            _Cagette.userId = :: user.id:: ;
            _Cagette.userName = "::user.getName()::";
            _Cagette.userEmail = "::user.email::";
            :: end::
			for( n of document.querySelectorAll(".btn:not(.btn-noAntiDoubleClick)") ){
				n.addEventListener("click",function(e){
					e.target.classList.add("disabled");
					setTimeout(function(){
						e.target.classList.remove("disabled");
					}, 300);
				});
			}
        })

    </script>

    ::foreach script getNeoModuleScripts()::
    <script src="::script::"></script>
    ::end::

</body>

</html>